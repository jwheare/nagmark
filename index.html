<html>
<body>
    <script>
    function getCookie (name) {
        var namekey = name + "=";
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length;i++) {
            var c = cookies[i];
            while (c.charAt(0) == ' ') {
                c = c.substring(1, c.length);
            }
            if (c.indexOf(namekey) === 0) {
                return c.substring(namekey.length, c.length);
            }
        }
        return null;
    }
    
    function setCookieAndRedirect (key, max) {
        var value = getCookie(key);
        var visits = 0;
        var expires = new Date();
        
        if (value) {
            valueParts = value.split("|");
            visits = valueParts[0];
            expires.setTime(valueParts[1]);
        } else {
            expires.setTime(expires.getTime() + (24*60*60*1000));
        }
        
        var newVisits = (visits - 0) + 1;
        if (newVisits > max) {
            if (!confirm("Youâ€™ve visited " + decodeURIComponent(parts.url) + " " + visits + " times in the last 24 hours, are you sure you want to do it again?")) {
                window.history.back();
            }
        }
        
        var newValue = newVisits + "|" + expires.getTime();
        
        var newCookie = key + "=" + newValue
            + "; expires=" + expires.toGMTString()
            + "; path=" + window.location.pathname;
        document.cookie = newCookie;
        window.location = decodeURIComponent(parts.url);
    }
    
    function parseUrl () {
        var parts = {};
        var params = window.location.search.substring(1);
        if (params) {
            var paramParts = params.split('&');
            var kv;
            for (var i = 0; i < paramParts.length; i++) {
                kv = paramParts[i].split('=');
                parts[kv[0]] = kv[1];
            }
        }
        return parts;
    }
    
    var parts = parseUrl();
    if (parts.url) {
        var key = parts.url;
        var max = (parts.max || 5) - 0;
        if (parts.nagmark) {
            var nagmark = window.location.protocol + '//' + window.location.host + '/?url=' + parts.url + '&max=' + max;
            document.write('<p>Nagmark: <a href="' + nagmark + '">' + nagmark + '</a></p>');
        } else {
            setCookieAndRedirect(key, max);
        }
    }
    </script>
    
    <form>
        <label for="nagUrl">URL:</label>
        <input name="url" id="nagUrl">
        <label for="nagMax">Visits before nag:</label>
        <input name="max" id="nagMax" value="5">
        <input type="hidden" name="nagmark" value="1">
        <input type="submit" value="Nagmark it!">
    </form>
</body>
</html>